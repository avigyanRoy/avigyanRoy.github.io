import React,{useState,useEffect} from "react";
import {Link,useNavigate, useParams} from "react-router-dom";
import axios from "axios";
function ApplicationHomePage(){
    const navigate= useNavigate();
    const [questions, setQuestions ]= useState([]);
    useEffect(() => {
        // Fetch the data from the backend when the component mounts
        axios
          .get("http://localhost:3001/home")
          .then((response) => {
            
            setQuestions(response.data);
            console.log(questions);
          })
          .catch((error) => {
            console.log("Error while fetching data: ", error);
          });
      }, []);

      async function handleTitleClick(q_title, e) {
        e.preventDefault(); // Prevent default link behavior
        try {
          navigate(`/qapage/${encodeURIComponent(q_title)}`); // Pass the q_title as a parameter in the URL
        } catch (e) {
          console.log(e);
          alert("Error occurred while processing the request.");
        }
      }
      
      
    return(
        <div className="home-page-container">
            <div className="left-pane">
                <div className="list-of-options">
                    <Link to="/home" className="home-link">
                    <div className="option-btn ">
                        Home
                    </div>
                    </Link>
                    <div className="sub-section-of-topics">PUBLIC</div>
                    <div className="option-btn">
                        Tags
                    </div>
                    <div className="option-btn">
                        Users
                    </div>
                    <div className="option-btn">
                        Companies
                    </div>

                    <div className="sub-section-of-topics">COLLECTIVES</div>
                    <div className="option-btn">
                        Explore Collectives
                    </div>
                </div>
            </div>

            <div className="questions-panel">
                <div className="top-section">
                    <div className="top-questions-title">
                        All Questions
                    </div>
                    <div className="ask-question-btn-div">
                        <Link to="/askaquestion" className="ask-question-link">
                        <button className="ask-question-button">
                            Ask Question
                        </button>
                        </Link>
                    </div>
                </div>

                <div className="question-list">
                    
                    {
                        
                    questions.map((question)=>(
                        
                        (
                            <div className="question-container">
                              <div className="question-stats">
                                {/* <div className="number-of-votes">
                                  {Math.abs(question.up_votes - question.down_votes)} votes
                                </div> */}
                                <div className="number-of-answers">
                                  {question.no_of_answers} answers
                                </div>
                              </div>
                              <div className="title-and-author-section">
                              <Link to={`/qapage/${encodeURIComponent(question.title)}`} className="qapage-link"><div className="question-title" onClick={(e) => handleTitleClick(question.title,e)}>{question.title}</div></Link>
                              <div className="question-author">{question.author_name}</div>
                              </div>
                              
                            </div>
                          )
                    ))}
                    
                </div>
            </div>
        </div>
    );
}

export default ApplicationHomePage;